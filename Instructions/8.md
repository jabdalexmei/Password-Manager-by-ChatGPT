

# ТЗ UI-VAULT-CANON-01 — Vault UI по канону (Deleted / DataCards / диалоги / запреты)

## 0) Цель

1. В UI и коде Vault **везде DataCard/Data cards**, никаких `Entry/Entries`.  
2. При выборе пункта **Deleted** (корзина) **кнопка Add folder НЕ пропадает**.
3. Диалоги **Create data card** и **Create folder** выглядят нормально и сделаны **по канону**: модалка внутри своего модуля, логика в `use<Module>.ts`. 
4. Тексты UI — **только через i18n**, DataCards тексты лежат в `i18n/English/DataCards.json`. 
5. Стили — только через `styles/app.css` и структуру `themes/base/ui/screens`. 

---

## 1) Канонические ограничения (обязательные)

1. **Один модуль = два файла**: `<Module>.tsx` (UI + диалоги), `use<Module>.ts` (state/handlers/CRUD). 
2. **Логика только в хуках** (`useState/useEffect` и т.п. — только в `use<Module>`, не в JSX). 
3. **Модалки внутри модуля** (не в `components/modals/*`). 
4. **Модули Vault/components не импортируют друг друга**, связь только через `useVault.ts`. 
5. **Toasts** вызываются **только из use***, тексты только i18n. 
6. **Clipboard**: бэкенд не трогает, фронт при копировании секрета ставит таймер и очищает буфер через `clipboard_clear_timeout_seconds`. 
7. **Стили**: импорт только через `styles/app.css`, общие кнопки/диалоги/тосты — `styles/ui.css`, экранный Vault — `styles/screens/vault.css`. 

---

## 2) Удалить “мусорную” структуру модалок (привести к канону)

### 2.1 Удалить папку модалок (если существует)

* Удалить целиком: `src/features/Vault/components/modals/`

  * включая `CreateDataCardModal.tsx`, `CreateFolderModal.tsx` и любые другие.

### 2.2 Встроить диалоги в модули

* Диалог создания DataCard — **внутри**:
  `src/features/Vault/components/DataCards/DataCards.tsx`
* Диалог создания Folder — **внутри**:
  `src/features/Vault/components/Folders/Folders.tsx`

---

## 3) BUG: Deleted → пропадает кнопка Add folder

### 3.1 Требование

Кнопки **Add data card** и **Add folder** находятся в sidebar actions и **не зависят** от выбранного пункта (All/Favorites/Archive/Deleted/Folder).

### 3.2 Изменения

Файл: `src/features/Vault/Vault.tsx`

* Блок всегда рендерится:

  * `<button className="btn btn-primary">` → `label.addDataCard`
  * `<button className="btn btn-secondary">` → `label.addFolder`
* Запрещено заворачивать Add folder в условия `!isTrashMode`, `selectedNav !== "deleted"` и т.п.

### 3.3 Поведение при создании, если выбран Deleted

* Если `selectedNav === "deleted"`:

  * Create Folder: после успешного создания **переключить навигацию на новую папку** (чтобы пользователь сразу её видел).
  * Create DataCard: создать обычную активную карточку (folder_id = null), после успеха **переключить навигацию на All**, выбрать созданную карточку.

---

## 4) Запрет терминов “Entry/Entries” + правильные названия “Data cards”

### 4.1 Глобальная чистка кода

В `src/**` выполнить поиск и **полностью убрать**:

* `Entry`, `Entries`, `Add entry`
* `entry_*`, `Entries.json`
* `selectedEntry*`, `entryId`, `entry` в контексте DataCard

Заменить на:

* `DataCard`, `Data cards`, `Add data card`
* `card`, `dataCard`, `dataCardId`, `selectedCardId`

Это обязательное правило канона. 

### 4.2 i18n (обязательно)

Файл: `src/i18n/English/DataCards.json` должен существовать и содержать тексты для модуля карточек. 
Перенести все строки из JSX (заголовки, кнопки, ошибки валидации) в i18n:

* `label.dataCardsTitle` = “Data cards”
* `label.addDataCard` = “Add data card”
* `dialog.createDataCardTitle` = “Create data card”
* `validation.titleRequired` = “Title is required”
* и т.д.

Аналогично для папок (если по проекту предусмотрен отдельный JSON для Folders — использовать его; если нет, допускается временно хранить folder-тексты в общем Vault/или DataCards, но **без хардкода в JSX**).

---

## 5) Create DataCard — правильный диалог и поля (без лишнего)

### 5.1 Где реализовать

* UI (разметка диалога) — внутри `src/features/Vault/components/DataCards/DataCards.tsx`
* State/handlers/CRUD/валидация — в `src/features/Vault/components/DataCards/useDataCards.ts`

### 5.2 Поля диалога (минимум)

Показывать только:

* Title (required)
* URL
* Username
* Email
* Password
* Mobile phone
* Note
* Tags (одна строка `tag1, tag2` → внутри хука парсится в массив)

**Запрещено** добавлять на этом шаге: bank_card, custom_fields.

### 5.3 Валидация

* `title.trim()` обязателен:

  * если пусто → показать inline error из i18n (`validation.titleRequired`), диалог не закрывать.
* Остальные поля — без обязательности.

### 5.4 Контракт с бэкендом (create_datacard)

Payload должен соответствовать API домена DataCards. 
Требования:

* Отправлять `folder_id`:

  * если выбрана пользовательская папка → её id
  * иначе → `null`
* `mobile_phone`, `note` — как в модели
* `tags` — массив строк (нормализовать: trim, убрать пустые, уникализировать)
* `custom_fields: []`
* `bank_card: null`

### 5.5 После успешного create

* Закрыть диалог
* Обновить список карточек (через `useVault` → refresh)
* Выбрать созданную карточку (если create возвращает объект с id — выбрать по id)

---

## 6) Create Folder — правильный диалог

### 6.1 Где реализовать

* UI (диалог) — внутри `src/features/Vault/components/Folders/Folders.tsx`
* Логика — `src/features/Vault/components/Folders/useFolders.ts`

### 6.2 Поля

* Только `Name` (required)

### 6.3 Валидация

* `name.trim()` обязателен:

  * пусто → inline error из i18n (`validation.folderNameRequired`)

### 6.4 Контракт с бэкендом (create_folder)

Использовать команду домена Folders. 

* `parent_id` = `null` (если иерархию папок не делаете сейчас)

### 6.5 После успешного create

* Закрыть диалог
* Refresh folders
* Выбрать созданную папку (selectedNav = `{ folderId: newId }`)

---

## 7) UI тексты и заголовки (только i18n)

Обязательные замены (без хардкода):

* “Entries” → “Data cards”
* “Add entry” → “Add data card”
* “Create entry” → “Create data card”
  Все строки — через i18n JSON. 

---

## 8) Стили (без самодеятельности)

### 8.1 Запрет

Не добавлять новые css-архитектуры типа `layout.css/shell.css/...`

### 8.2 Разрешено

* Если не хватает стиля для `btn-secondary` или для диалогов:

  * добавить/исправить в `src/styles/ui.css` (общие компоненты) 
* Экранные правки (раскладка Vault) — только `src/styles/screens/vault.css` 
* Импорт **только** через `src/styles/app.css`. 

---

## 9) Clipboard (обязательное поведение при Copy secrets)

В `useDetails.ts` (или в том хуке, который обслуживает Details) реализовать:

* `copyToClipboard(text, isSecret: boolean)`
* Если `isSecret`:

  * после `navigator.clipboard.writeText(text)` запустить таймер на `clipboard_clear_timeout_seconds` и по истечении записать пустую строку (или заглушку).
* Таймер хранить в хуке, при новом копировании — предыдущий сбрасывать.

Это требование бекенда: бэкенд не трогает clipboard, фронт чистит. 

---

## 10) Приёмка (что проверять)

1. Выбираем **Deleted** → обе кнопки **Add data card** и **Add folder** видны всегда, кликабельны.
2. В UI/коде нет `Entry/Entries` (включая имена файлов/переменных). 
3. Create data card диалог:

   * красивый (как остальные диалоги проекта),
   * Title обязателен,
   * создаёт карточку через `create_datacard`, после успеха обновляет список и выбирает созданную.
4. Create folder диалог:

   * Name обязателен,
   * создаёт через `create_folder`, обновляет список папок и выбирает новую папку.
5. Все тексты берутся из i18n (DataCards.json обязателен). 
6. Copy password запускает таймер очистки буфера. 
7. Стиль не подключается “в обход” — только app.css → themes/base/ui/screens. 

---

