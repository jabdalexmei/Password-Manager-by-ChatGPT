

## Technical Specification (EN): Workspace screen UI redesign (match provided mock) + “Open data folder” picker behavior

### 1) Scope

Frontend-only UI redesign for Workspace screen to match the provided mock (rounded card, left workspace list cards, right CTA column). Also fix “Open data folder” button logic:

* When no valid active workspace exists, it opens a directory picker and initializes the selected folder as a workspace (calls `workspaceCreate(path)`).

Folder picker API: `@tauri-apps/plugin-dialog` `open({ directory: true, multiple: false })`. ([Tauri][1])

### 2) Requirements

#### 2.1 Visual layout

* Centered large card on a blue/dark gradient background (keep existing `--bg-startup-screen`).
* Card content:

  * Title: “Workspace”
  * Subtitle: “Choose or create a data folder before continuing.”
* Two columns:

  * Left: “Available workspaces” and list.
  * Right: vertical actions:

    * Create (primary, wide)
    * Open data folder (secondary, wide)
    * Use default path (checkbox aligned bottom-right)

#### 2.2 Workspace list item design

Each workspace item is a rounded “tile”:

* Top row: workspace name + path; on the right a **3-dots Action Bar button**:

  * Must be visible but does nothing for now (placeholder for future menu).
  * Clicking it must not select/open/delete the workspace.
* Bottom row:

  * Left: **Delete** (danger/red)
  * Right: **Open** (primary/blue) ✅ (this is the user’s requirement)
* Selecting a tile highlights it (blue border).

#### 2.3 Open data folder behavior

* The “Open data folder” button must be enabled even when there are no workspaces.
* Behavior:

  * If there is an active workspace that is `exists && valid`: call `workspaceOpenInExplorer()`.
  * Else: open directory picker (`open({ directory: true, multiple: false })`) and if user selects a folder call `workspaceCreate(selectedPath)` to initialize/add it.

### 3) Files to change

* `src/features/Workspace/Workspace.tsx` (markup + button logic)
* `src/styles/screens/workspace.css` (full redesign CSS)
* `src/i18n/English/Workspace.json` (text updates: empty state + “Delete” label)

---

# 4) Exact changes

## 4.1 `src/features/Workspace/Workspace.tsx` — replace component content

Replace the file **entirely** with the following code:

```tsx
import React, { useCallback, useMemo, useState } from 'react';
import { open } from '@tauri-apps/plugin-dialog';
import { useTranslation } from '../../lib/i18n';
import {
  workspaceCreate,
  workspaceCreateDefault,
  workspaceOpenInExplorer,
  workspaceSelect,
} from '../../lib/tauri';
import { useWorkspace } from './useWorkspace';

type WorkspaceProps = {
  onWorkspaceReady: () => void;
};

const Workspace: React.FC<WorkspaceProps> = ({ onWorkspaceReady }) => {
  const { t } = useTranslation('Workspace');
  const { workspaces, loading, error, selectedId, setSelectedId, refresh, remove } = useWorkspace();
  const [useDefaultPath, setUseDefaultPath] = useState(false);
  const [busy, setBusy] = useState(false);

  const selectedWorkspace = useMemo(
    () => workspaces.find((w) => w.id === selectedId) ?? null,
    [selectedId, workspaces]
  );

  const activeWorkspace = useMemo(
    () => workspaces.find((w) => w.is_active) ?? null,
    [workspaces]
  );

  const handleSelect = useCallback(
    async (id: string) => {
      setBusy(true);
      try {
        await workspaceSelect(id);
        await refresh();
        onWorkspaceReady();
      } finally {
        setBusy(false);
      }
    },
    [onWorkspaceReady, refresh]
  );

  const handleCreate = useCallback(async () => {
    setBusy(true);
    try {
      if (useDefaultPath) {
        await workspaceCreateDefault();
      } else {
        const selected = await open({
          directory: true,
          multiple: false,
          title: t('chooseFolder'),
        });
        if (typeof selected !== 'string') {
          return;
        }
        await workspaceCreate(selected);
      }
      await refresh();
      onWorkspaceReady();
    } finally {
      setBusy(false);
    }
  }, [onWorkspaceReady, refresh, t, useDefaultPath]);

  // IMPORTANT: this button acts as:
  // - "open in Explorer" when active workspace is valid
  // - "browse/select folder" when there is no valid active workspace
  const handleOpenDataFolder = useCallback(async () => {
    setBusy(true);
    try {
      if (activeWorkspace && activeWorkspace.exists && activeWorkspace.valid) {
        await workspaceOpenInExplorer();
        return;
      }

      const selected = await open({
        directory: true,
        multiple: false,
        title: t('chooseFolder'),
      });

      if (typeof selected !== 'string') {
        return;
      }

      await workspaceCreate(selected);
      await refresh();
      onWorkspaceReady();
    } finally {
      setBusy(false);
    }
  }, [activeWorkspace, onWorkspaceReady, refresh, t]);

  const workspaceListContent = useMemo(() => {
    if (loading) {
      return <p className="muted centered">{t('loading')}</p>;
    }

    if (error) {
      return <p className="muted centered">{t('error')}</p>;
    }

    if (!workspaces.length) {
      return (
        <div className="workspace-empty">
          <p className="workspace-empty-text">{t('empty')}</p>
        </div>
      );
    }

    return (
      <div className="workspace-list">
        {workspaces.map((workspace) => {
          const isSelected = workspace.id === selectedId;

          // keep status info (optional UI chip)
          const statusLabel = workspace.exists
            ? workspace.valid
              ? null
              : t('invalid')
            : t('missing');

          return (
            <div
              key={workspace.id}
              className={`workspace-tile ${isSelected ? 'selected' : ''}`}
              onClick={() => setSelectedId(workspace.id)}
              onKeyDown={(event) => {
                if (event.key === 'Enter') {
                  setSelectedId(workspace.id);
                }
              }}
              role="button"
              tabIndex={0}
            >
              <div className="workspace-tile-top">
                <div className="workspace-tile-info">
                  <div className="workspace-tile-title-row">
                    <p className="workspace-tile-title">{workspace.display_name}</p>
                    {statusLabel && <span className="workspace-status">{statusLabel}</span>}
                  </div>
                  <p className="workspace-tile-path">{workspace.path}</p>
                </div>

                {/* Action Bar placeholder (no behavior for now) */}
                <button
                  type="button"
                  className="btn btn-icon workspace-actionbar"
                  aria-label={t('actions')}
                  title={t('actions')}
                  onClick={(e) => {
                    e.stopPropagation();
                    // intentionally empty (future action menu)
                  }}
                >
                  <span className="workspace-actionbar-dots">⋯</span>
                </button>
              </div>

              <div className="workspace-tile-bottom">
                <button
                  type="button"
                  className="btn btn-danger workspace-btn-sm"
                  onClick={(e) => {
                    e.stopPropagation();
                    remove(workspace.id);
                  }}
                  disabled={busy}
                >
                  {t('removeFromList')}
                </button>

                <button
                  type="button"
                  className="btn btn-primary workspace-btn-sm"
                  onClick={(e) => {
                    e.stopPropagation();
                    handleSelect(workspace.id);
                  }}
                  disabled={!workspace.valid || busy}
                >
                  {t('open')}
                </button>
              </div>
            </div>
          );
        })}
      </div>
    );
  }, [busy, error, handleSelect, loading, remove, selectedId, setSelectedId, t, workspaces]);

  return (
    <div className="workspace-shell">
      <div className="workspace-card workspace-card-mock">
        <header className="workspace-header">
          <h1 className="workspace-title">{t('title')}</h1>
          <p className="workspace-subtitle">{t('subtitle')}</p>
        </header>

        <div className="workspace-mock-layout">
          <section className="workspace-left">
            <h2 className="workspace-section-title">{t('workspaces')}</h2>
            {workspaceListContent}
          </section>

          <section className="workspace-right">
            <button
              type="button"
              className="btn btn-primary workspace-cta"
              onClick={handleCreate}
              disabled={busy}
            >
              {t('create')}
            </button>

            <button
              type="button"
              className="btn btn-secondary workspace-cta-secondary"
              onClick={handleOpenDataFolder}
              disabled={busy}
            >
              {t('openDataFolder')}
            </button>

            <label className="workspace-default-path">
              <input
                type="checkbox"
                checked={useDefaultPath}
                onChange={(event) => setUseDefaultPath(event.target.checked)}
                disabled={busy}
              />
              <span>{t('useDefaultPath')}</span>
            </label>

            {/* Optional: keep selection info hidden to match mock exactly */}
            <div className="workspace-selection-hint" aria-hidden="true">
              {selectedWorkspace ? selectedWorkspace.display_name : ''}
            </div>
          </section>
        </div>
      </div>
    </div>
  );
};

export default Workspace;
```

**Notes:**

* Directory picker is the official dialog plugin API and supports directory selection with `multiple: false`. ([Tauri][1])
* Action Bar (⋯) is intentionally a no-op placeholder.

---

## 4.2 `src/styles/screens/workspace.css` — replace CSS entirely (mock-matching)

Replace the file **entirely** with:

```css
.workspace-shell {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 42px;
  background: var(--bg-startup-screen);
}

.workspace-card.workspace-card-mock {
  width: min(1180px, 100%);
  border-radius: 28px;
  padding: 34px 36px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  background: rgba(2, 6, 23, 0.72);
  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(14px);
}

.workspace-header {
  margin-bottom: 18px;
}

.workspace-title {
  margin: 0;
  font-size: 34px;
  font-weight: 800;
  color: var(--color-text);
}

.workspace-subtitle {
  margin: 8px 0 0 0;
  font-size: 14px;
  color: var(--color-text-muted);
}

.workspace-mock-layout {
  display: grid;
  grid-template-columns: minmax(420px, 560px) minmax(340px, 1fr);
  gap: 28px;
  align-items: start;
}

.workspace-section-title {
  margin: 10px 0 14px;
  font-size: 15px;
  font-weight: 700;
  color: var(--color-text);
}

.workspace-left {
  min-width: 0;
}

.workspace-right {
  display: flex;
  flex-direction: column;
  gap: 14px;
  min-width: 0;
}

.workspace-cta {
  width: 100%;
  border-radius: 14px;
  padding: 14px 16px;
}

.workspace-cta-secondary {
  width: 100%;
  border-radius: 14px;
  padding: 14px 16px;
}

.workspace-default-path {
  margin-top: auto;
  align-self: flex-end;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  color: var(--color-text);
  user-select: none;
}

.workspace-selection-hint {
  display: none;
}

.workspace-empty {
  margin-top: 10px;
  border-radius: 18px;
  border: 1px dashed rgba(255, 255, 255, 0.10);
  padding: 18px;
  background: rgba(15, 23, 42, 0.35);
}

.workspace-empty-text {
  margin: 0;
  color: var(--color-text-muted);
  font-size: 14px;
}

/* List */
.workspace-list {
  display: flex;
  flex-direction: column;
  gap: 14px;
  max-height: 420px;
  overflow: auto;
  padding-right: 6px;
}

.workspace-tile {
  border-radius: 18px;
  border: 1px solid rgba(255, 255, 255, 0.10);
  background: rgba(15, 23, 42, 0.55);
  padding: 16px 16px 14px;
  cursor: pointer;
  transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
}

.workspace-tile:hover {
  border-color: rgba(59, 130, 246, 0.45);
}

.workspace-tile.selected {
  border-color: rgba(59, 130, 246, 0.75);
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.20);
}

.workspace-tile-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
}

.workspace-tile-info {
  min-width: 0;
}

.workspace-tile-title-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.workspace-tile-title {
  margin: 0;
  font-size: 16px;
  font-weight: 800;
  color: var(--color-text);
}

.workspace-tile-path {
  margin: 6px 0 0;
  font-size: 12px;
  color: var(--color-text-muted);
  word-break: break-all;
}

/* Optional status chip */
.workspace-status {
  font-size: 12px;
  padding: 3px 10px;
  border-radius: 999px;
  color: rgba(255, 255, 255, 0.9);
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.12);
}

/* Action bar placeholder */
.workspace-actionbar {
  border-radius: 12px;
  border-color: rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.06);
}

.workspace-actionbar:hover {
  border-color: rgba(59, 130, 246, 0.55);
}

.workspace-actionbar-dots {
  font-size: 20px;
  line-height: 1;
  color: rgba(255, 255, 255, 0.88);
  transform: translateY(-1px);
}

/* Bottom buttons */
.workspace-tile-bottom {
  margin-top: 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.workspace-btn-sm {
  border-radius: 12px;
  padding: 10px 18px;
  min-width: 92px;
}

@media (max-width: 960px) {
  .workspace-mock-layout {
    grid-template-columns: 1fr;
  }

  .workspace-right {
    margin-top: 10px;
  }

  .workspace-default-path {
    align-self: flex-start;
  }
}
```

---

## 4.3 `src/i18n/English/Workspace.json` — update strings + add “actions”

Edit the file to:

```json
{
  "title": "Workspace",
  "subtitle": "Choose or create a data folder before continuing.",
  "workspaces": "Available workspaces",
  "loading": "Loading workspaces...",
  "error": "Unable to load workspaces.",
  "empty": "No workspaces yet. Use Create or Open data folder to select a folder and initialize it.",
  "chooseFolder": "Choose data folder",
  "create": "Create",
  "openDataFolder": "Open data folder",
  "useDefaultPath": "Use default path",
  "missing": "Missing",
  "invalid": "Invalid",
  "removeFromList": "Delete",
  "open": "Open",
  "actions": "Actions"
}
```

---

## 5) Acceptance criteria

1. UI matches the provided mock:

   * Open button inside workspace tile is **primary blue**
   * Delete is red
   * 3-dots Action Bar exists and is **no-op**
2. “Open data folder” is clickable even when the list is empty.
3. If there is a valid active workspace → “Open data folder” opens it in Explorer (`workspaceOpenInExplorer()`).
4. If there is no valid active workspace → “Open data folder” opens directory picker and initializes selected folder using `workspaceCreate(path)`. ([Tauri][1])



[1]: https://v2.tauri.app/plugin/dialog/?utm_source=chatgpt.com "Dialog"
