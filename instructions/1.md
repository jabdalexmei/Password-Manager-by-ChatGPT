

# Technical Specification (EN): Switch toggles only on switch click (no label-click toggling) across the app

## Goal

Across the app, for all custom toggle switches implemented as `<button role="switch">`:

* Clicking the visible text label MUST NOT toggle the switch.
* The switch toggles ONLY when:

  * user clicks the switch control itself, or
  * user uses keyboard (Space/Enter) while the switch control is focused.
* Accessibility must be preserved via `aria-labelledby` on the switch. ([W3C][3])

## Rationale

HTML `<label for="...">` activates/focuses the associated control when clicked. This is expected behavior and is why your switch toggles when clicking the label text. ([MDN Web Docs][1])
For custom switches (button-based), use a non-label text element and provide the switch name via `aria-labelledby`. ([MDN Web Docs][2])

## Scope

Frontend only. No business logic changes.

## Files to change (minimum known)

* `src/features/Vault/components/modals/SettingsModal.tsx`
* `src/features/Vault/components/modals/ExportBackupModal.tsx`

Additionally, apply the same rule to **every other** switch in the codebase (see section “Project-wide enforcement”).

---

## 1) SettingsModal: “Auto backup enabled” label must not toggle switch

### File

`src/features/Vault/components/modals/SettingsModal.tsx`

### Change

Replace the clickable `<label htmlFor="...">` with a non-label text element.

#### Before

```tsx
<label className="form-label" id="backup-auto-enabled-label" htmlFor="backup-auto-enabled-switch">
  Auto backup enabled
</label>
```

#### After

```tsx
<span className="form-label" id="backup-auto-enabled-label">
  Auto backup enabled
</span>
```

### Requirements

* Keep the switch button as-is, especially:

  * `role="switch"`
  * `aria-checked={autoBackupEnabled}`
  * `aria-labelledby="backup-auto-enabled-label"` ([MDN Web Docs][4])
* Ensure there is **no** `onClick` handler on the label text element.

---

## 2) SettingsModal: “Enable auto-lock” label must not toggle switch

### File

`src/features/Vault/components/modals/SettingsModal.tsx`

### Change

#### Before

```tsx
<label className="form-label" id="auto-lock-enabled-label" htmlFor="auto-lock-enabled-switch">
  Enable auto-lock
</label>
```

#### After

```tsx
<span className="form-label" id="auto-lock-enabled-label">
  Enable auto-lock
</span>
```

### Requirements

* Switch button must keep:

  * `role="switch"`
  * `aria-checked={autoLockEnabled}`
  * `aria-labelledby="auto-lock-enabled-label"` ([MDN Web Docs][4])
* No `onClick` on the text element.

---

## 3) ExportBackupModal: “Use default path” text must not toggle switch

### File

`src/features/Vault/components/modals/ExportBackupModal.tsx`

### Change

If the file currently uses either:

* `<label htmlFor="...">Use default path</label>`, or
* text element with `onClick={() => setUseDefaultPath(...)}`,

then remove label activation behavior.

#### Required structure (exact)

```tsx
<span className="form-label" id="use-default-path-label">
  Use default path
</span>

<button
  id="use-default-path-switch"
  type="button"
  role="switch"
  aria-checked={useDefaultPath}
  aria-labelledby="use-default-path-label"
  disabled={busy}
  onClick={() => setUseDefaultPath((v) => !v)}
  onKeyDown={(e) => {
    if (busy) return;
    if (e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      setUseDefaultPath((v) => !v);
    }
  }}
>
  ...
</button>
```

### Requirements

* The text element MUST NOT be `<label>` with `htmlFor`.
* The text element MUST NOT have `onClick`.
* The switch must keep `aria-labelledby` pointing at the text element for accessible naming. ([MDN Web Docs][2])

---

## 4) Project-wide enforcement (all switches)

### Rule

For every custom switch in the codebase:

* The visible label must be a **non-label** element (`span/div/p`) with a stable `id`.
* The switch element must be:

  * `<button role="switch">`
  * must include `aria-checked={...}`
  * must include `aria-labelledby="label-id"` ([MDN Web Docs][4])
* Do not use `<label for>` for a switch, because clicking it activates the linked control by design. ([MDN Web Docs][1])

### Exact search command to identify all switches

Run in repo root:

```bash
rg -n "role=\"switch\"" src
```

For each match, ensure the label element is not `<label htmlFor=...>` and does not have `onClick`.

---

## Acceptance Criteria

1. **SettingsModal**

* Clicking “Auto backup enabled” text does **not** toggle the switch.
* Clicking “Enable auto-lock” text does **not** toggle the switch.
* Clicking the switch itself toggles correctly.
* Keyboard Space/Enter toggles when focused on the switch. ([MDN Web Docs][4])

2. **ExportBackupModal**

* Clicking “Use default path” text does **not** toggle the switch.
* Clicking the switch toggles correctly.
* All existing backup logic remains unchanged.

3. **No regressions**

* All switches still have accessible names via `aria-labelledby`. ([MDN Web Docs][2])

