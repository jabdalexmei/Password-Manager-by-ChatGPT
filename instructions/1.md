

## TS Delta (EN): “Open data folder” acts as a workspace folder picker when no workspace exists

### Change request

The “Open data folder” button must **never** be disabled due to “No workspaces yet…”.
Instead, when there is no active workspace, it must open a **directory picker** and then **initialize/add** the selected folder as a workspace.

### Updated UX behavior

* If an **active workspace exists and is valid**:

  * “Open data folder” opens the active workspace folder in Windows Explorer.
* Else (no workspaces yet OR none selected OR selected invalid/missing):

  * “Open data folder” opens a **directory picker**.
  * If user selects a folder:

    * call backend `workspace_create(path)` (same command used by “Create” without default path)
    * refresh workspace list
    * optionally auto-select and proceed to Startup (consistent with your current flow).

**Rationale:** this makes the button a “Browse…” entry point and avoids dead-end UX.

### Sources (for implementer)

* Tauri v2 Dialog plugin `open({ directory: true, multiple: false })` and `defaultPath` option. ([Tauri][1])
* If you use opener plugin, it’s the official way to reveal/open paths, with permissions/scopes to allow opening paths. ([Tauri][2])

---

## Exact code changes

### 1) Frontend: enable button and change handler logic

#### File: `src/features/Workspace/Workspace.tsx`

**A) Ensure button is not disabled by “no workspaces” state**

Find the “Open data folder” button. Right now it’s likely disabled with logic similar to:

* disabled when `workspaces.length === 0` or when there’s no active

**Replace the disabled condition to only depend on `busy`**:

```tsx
<Button
  onClick={handleOpenDataFolder}
  disabled={busy}   // <-- ONLY busy disables it
>
  {t('openDataFolder')}
</Button>
```

**B) Update `handleOpenDataFolder` to be dual-mode (Explorer OR picker)**

You already import dialog open for Create; if not, add:

```ts
import { open } from '@tauri-apps/plugin-dialog';
```

Tauri docs confirm directory picker usage and `defaultPath`. ([Tauri][1])

Now replace `handleOpenDataFolder` with:

```ts
const handleOpenDataFolder = useCallback(async () => {
  try {
    // If we have a valid active workspace, just open it in Explorer
    const active = workspaces.find(w => w.is_active);
    if (active && active.exists && active.valid) {
      await workspaceOpenInExplorer();
      return;
    }

    // Otherwise, act as a folder picker to select/init a workspace folder
    const selected = await open({
      directory: true,
      multiple: false,
      title: t('chooseFolder'),
      // Optional: open dialog in app dir or last known path if you track it
      // defaultPath: lastPath ?? undefined,
    });

    if (typeof selected !== 'string') {
      return; // user cancelled
    }

    // Initialize/add this folder as a workspace
    await workspaceCreate(selected);

    // Refresh list and proceed (consistent with Create behavior)
    await refresh();
    onWorkspaceReady();
  } catch (err: any) {
    show(mapWorkspaceError(err?.code), { title: t('errorTitle') });
  }
}, [onWorkspaceReady, refresh, show, t, workspaces]);
```

> `defaultPath` — опционально. Можно позже сделать “умным”: открывать диалог в папке последнего workspace/активного. Это прям поддержано в dialog API. ([Tauri][3])

### 2) Text/UI: empty state message should not imply “Open is useless”

Если у тебя сейчас рендерится строка “No workspaces yet. Create one to get started.” — оставь, но добавь подсказку, что можно и через Open:

#### File: `src/i18n/English/Workspace.json`

Добавь ключ (или обнови существующий):

```json
{
  "noWorkspaces": "No workspaces yet. Use Create or Open data folder to select a folder and initialize it."
}
```

И используй его в empty state вместо старого текста.

---

## Backend changes

**Не нужны**, если `workspace_create(path)` уже умеет:

* создать marker `.pm-workspace.json`
* создать `Profiles\`
* добавить в registry + сделать активным

(Судя по текущей архитектуре — именно так.)

---

## Acceptance criteria

1. При пустом списке workspaces кнопка **Open data folder активна**.
2. Нажатие “Open data folder” открывает **directory picker**. ([Tauri][1])
3. Выбор папки приводит к `workspace_create(path)` → папка становится workspace и появляется в списке.
4. Если есть валидный активный workspace — “Open data folder” открывает его в Explorer (через твой текущий механизм/плагин). ([Tauri][2])

