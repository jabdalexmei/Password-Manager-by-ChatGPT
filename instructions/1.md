

## Technical Specification (EN): Show custom fields in Details panel

### Goal

Render `DataCard.customFields[]` in the **Details** panel (right side card information) so the user can see (and copy) all custom fields created for a data card.

### Scope

* Show custom fields **after “Mobile phone”** in the Details panel.
* Render only fields with non-empty values (same UX rule used for other optional fields).
* Support **secret** custom fields:

  * Mask value by default (`••••••••••••`)
  * Provide reveal/hide toggle per field
  * Copy action uses existing clipboard logic with `isSecret: true` (so clipboard auto-clear behavior remains consistent). ([MDN Web Docs][1])
* Keep UI consistent with existing Details “detail-field / detail-value-box / icon-button” layout.

### Non-goals

* No new DB schema / migrations.
* No editing/creating custom fields here (only display).
* No new backend endpoints.

---

## Implementation details

### 1) Update Details panel rendering

**File to edit**
`src/features/Vault/components/Details/Details.tsx`

#### A) Update imports

Currently:

```ts
import { DataCard, Folder } from '../../types/ui';
```

Change to:

```ts
import { DataCard, Folder, CustomField } from '../../types/ui';
```

#### B) Add local state to track per-field reveal/hide

Inside `Details()` component (near other `useState` blocks), add:

```ts
const [revealedCustomFields, setRevealedCustomFields] = useState<Record<string, boolean>>({});

useEffect(() => {
  // reset reveal states when switching cards
  setRevealedCustomFields({});
}, [card?.id]);

const toggleCustomFieldVisibility = (fieldId: string) => {
  setRevealedCustomFields((prev) => ({
    ...prev,
    [fieldId]: !prev[fieldId],
  }));
};
```

#### C) Insert custom fields block after Mobile phone field

Find the existing block:

```tsx
{hasMobilePhone && (
  <div className="detail-field">
    <div className="detail-label">{t('label.mobile')}</div>
    <div className="detail-value-box">
      <div className="detail-value-text">{card.mobilePhone ?? ''}</div>
      <div className="detail-value-actions">
        <button
          className="icon-button"
          type="button"
          aria-label={t('action.copy')}
          onClick={() => detailActions.copyToClipboard(card.mobilePhone)}
        >
          <IconCopy />
        </button>
      </div>
    </div>
  </div>
)}
```

**Immediately after it**, insert:

```tsx
{(card.customFields ?? [])
  .filter((field) => Boolean(field.value?.trim()))
  .map((field: CustomField, index: number) => {
    const fieldId = `custom-field-${index}-${field.key}`;
    const isSecret = field.type === 'secret';
    const isRevealed = Boolean(revealedCustomFields[fieldId]);

    const displayValue = isSecret
      ? (isRevealed ? field.value : '••••••••••••')
      : field.value;

    return (
      <div key={fieldId} className="detail-field">
        <div className="detail-label">{field.key}</div>

        <div className="detail-value-box">
          <div className="detail-value-text">{displayValue}</div>

          <div className="detail-value-actions">
            <button
              className="icon-button"
              type="button"
              aria-label={t('action.copy')}
              onClick={() => detailActions.copyToClipboard(field.value, { isSecret })}
            >
              <IconCopy />
            </button>

            {isSecret && (
              <button
                className="icon-button"
                type="button"
                aria-label={isRevealed ? t('action.hide') : t('action.reveal')}
                onClick={() => toggleCustomFieldVisibility(fieldId)}
              >
                {isRevealed ? <IconPreviewOff /> : <IconPreview />}
              </button>
            )}
          </div>
        </div>
      </div>
    );
  })}
```

Notes:

* Uses existing icons already imported in this file (`IconCopy`, `IconPreview`, `IconPreviewOff`).
* Uses existing translations already present in `Details.json`:

  * `action.copy`, `action.reveal`, `action.hide`
* Clipboard behavior is consistent with existing “secret copy” flows. ([MDN Web Docs][1])

---

## Acceptance criteria

1. Open any DataCard that has `customFields` with non-empty values.
2. In Details panel, **after Mobile phone** and **before Password**:

   * Each custom field is shown as a standard detail block:

     * label = `customFields[i].key`
     * value = `customFields[i].value` (or masked for secret)
3. Each custom field has a **Copy** icon button.
4. For `type === 'secret'` fields:

   * Value is masked by default
   * Reveal/Hide toggle changes only that specific field
5. Switching selected card resets reveal states (no leaking secret visibility across cards).


