

## TS 1 â€” Show TOTP code + expires in Create/Edit dialog (under Password)

### File: `src/features/Vault/components/DataCards/DataCards.tsx`

**Purpose:** Render TOTP preview block under Password (before custom fields) and update token every second while Create/Edit dialog is open.

```diff
--- src/features/Vault/components/DataCards/DataCards.tsx (before)
+++ src/features/Vault/components/DataCards/DataCards.tsx (after)
@@ -16,6 +16,7 @@
 import { Add2FAModal } from '../modals/Add2FAModal';
 import { useToaster } from '../../../../shared/components/Toaster';
 import { generatePassword, PasswordGeneratorOptions } from '../../utils/passwordGenerator';
+import { generateTotpCode } from '../../utils/totp';
 import { DataCardFormState, DataCardsViewModel } from './useDataCards';
 import { open } from '@tauri-apps/plugin-dialog';
 import { clipboardClearAll } from '../../../../shared/lib/tauri';
@@ -88,6 +89,8 @@
   const genPwdLastCopiedRef = useRef<string | null>(null);
   const actionMenuRef = useRef<HTMLDivElement | null>(null);
   const actionMenuButtonRef = useRef<HTMLButtonElement | null>(null);
+
+  const [totpNow, setTotpNow] = useState(() => Date.now());
 
   const regeneratePassword = useCallback((options: PasswordGeneratorOptions) => {
     const { password, charsetSize: size } = generatePassword(options);
@@ -158,6 +161,16 @@
   }, [isCreateOpen, isEditOpen]);
 
   useEffect(() => {
+    const activeUri = (
+      isCreateOpen ? viewModel.createForm?.totpUri : isEditOpen ? viewModel.editForm?.totpUri : null
+    ) ?? '';
+    if (!activeUri.trim()) return;
+
+    const id = window.setInterval(() => setTotpNow(Date.now()), 1000);
+    return () => window.clearInterval(id);
+  }, [isCreateOpen, isEditOpen, viewModel.createForm?.totpUri, viewModel.editForm?.totpUri]);
+
+  useEffect(() => {
     if (isCreateOpen || isEditOpen) return;
     setIsActionMenuOpen(false);
     setIsCustomFieldModalOpen(false);
@@ -292,6 +305,17 @@
 
     const titleElementId = 'dialog-title';
     const isCreateDialog = dialogId === 'datacard-create-dialog';
+
+    const totpUri = (form.totpUri ?? '').trim();
+    let totpData: { token: string; remaining: number } | null = null;
+    if (totpUri) {
+      try {
+        totpData = generateTotpCode(totpUri, totpNow);
+      } catch {
+        totpData = null;
+      }
+    }
 
     return (
       <div className="dialog-backdrop">
@@ -454,9 +478,32 @@
                 </div>
               </div>
             </div>
 
+            {totpUri && (
+              <div className="form-field">
+                <label className="form-label">{t('label.totp')}</label>
+
+                <div className="detail-value-box">
+                  <div className="detail-value-text" style={{ display: 'flex', alignItems: 'baseline', gap: 12 }}>
+                    <span style={{ fontSize: 20, fontWeight: 700, letterSpacing: 2 }}>
+                      {totpData ? totpData.token : t('totp.invalid')}
+                    </span>
+
+                    {totpData && (
+                      <span className="muted" style={{ fontSize: 12 }}>
+                        {t('totp.expiresIn', { seconds: totpData.remaining })}
+                      </span>
+                    )}
+                  </div>
+                </div>
+              </div>
+            )}
+
             {form.customFields.map((row) => (
               <div className="form-field" key={row.id}>
                 <label className="form-label" htmlFor={`${dialogId}-cf-${row.id}`}>
                   {row.key}
                 </label>
```

### File: `src/i18n/locales/en/DataCards.json`

**Purpose:** Provide labels for TOTP block in Create/Edit dialog (same wording as Details).

```diff
--- src/i18n/locales/en/DataCards.json (before)
+++ src/i18n/locales/en/DataCards.json (after)
@@ -11,6 +11,7 @@
   "label.email": "Email",
   "label.url": "URL",
   "label.password": "Password",
+  "label.totp": "2FA (TOTP)",
   "label.mobile": "Mobile phone",
   "label.note": "Note",
   "label.tags": "Tags",
@@ -42,6 +43,8 @@
   "label.markFavorite": "Mark as favorite",
   "validation.titleRequired": "Title is required",
   "validation.folderNotFound": "Folder not found",
+  "totp.invalid": "Invalid 2FA configuration",
+  "totp.expiresIn": "expires in {{seconds}}s",
   "generator.title": "Password generator",
   "generator.generatedPassword": "Generated password",
   "generator.regenerate": "Regenerate",
```

