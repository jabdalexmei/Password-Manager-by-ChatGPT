

# Technical Specification: Fix compile errors and migrate window event handler to Tauri v2

## Goal

Resolve current Rust compilation errors and ensure the app uses Tauri v2 window event handler API.

## Errors to fix

1. `error[E0432]: unresolved import rusqlite::OwnedData`
2. `error[E0593]: closure is expected to take 2 arguments, but it takes 1 argument` in `.on_window_event(...)`

---

## 1) Fix `OwnedData` import for rusqlite 0.32.x

### File

`src-tauri/src/services/security_service.rs`

### Change

Replace the incorrect import of `OwnedData` from the rusqlite root with the correct module path.

#### Before

```rust
use rusqlite::{DatabaseName, OwnedData};
```

#### After

```rust
use rusqlite::DatabaseName;
use rusqlite::serialize::OwnedData;
```

### Acceptance Criteria

* `cargo build` no longer reports `E0432 unresolved import rusqlite::OwnedData`.

---

## 2) Migrate `.on_window_event` handler to Tauri v2 API

### Context

Your current `main.rs` uses the v1-style event wrapper (`|event| ... event.event() ... event.window() ...`). In Tauri v2, `.on_window_event(...)` expects a closure with **two arguments**: `(window, event)` and you match directly on the event value (no `.event()` call).

### File

`src-tauri/src/main.rs`

### Current code (as-is in uploaded `main.rs`)

```rust
        .on_window_event(|event| match event.event() {
            WindowEvent::CloseRequested { .. } | WindowEvent::Destroyed => {
                let app_state = event.window().state::<Arc<AppState>>().inner().clone();
                let _ = security_service::auto_lock_cleanup(&app_state);
            }
            _ => {}
        })
```

### Required replacement (Tauri v2)

Replace the entire `.on_window_event(...)` block above with:

```rust
        .on_window_event(|window, event| match event {
            WindowEvent::CloseRequested { .. } | WindowEvent::Destroyed => {
                let app_state = window.state::<Arc<AppState>>().inner().clone();
                let _ = security_service::auto_lock_cleanup(&app_state);
            }
            _ => {}
        })
```

### Notes

* This change removes:

  * `event.event()` (v1-only pattern)
  * `event.window()` (v1-only wrapper)
* It uses:

  * `window` (first closure arg) for `state::<Arc<AppState>>()`
  * `event` (second closure arg) matched directly as `WindowEvent`

### Acceptance Criteria

* `cargo build` no longer reports `E0593` about closure arguments.
* The app still calls `security_service::auto_lock_cleanup(&app_state)` on `CloseRequested` and `Destroyed`.

---

## End-to-end Acceptance Criteria

* Running `cargo build` in `src-tauri` completes without errors.

