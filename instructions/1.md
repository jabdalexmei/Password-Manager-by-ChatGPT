## TECHNICAL SPECIFICATION (EN): Project Restructuring in 2 Stages (safe, Windows-only)

### Background / rationale (why this is the right direction)

* **Feature-based structure** scales better: code is grouped by product features, not by technical type. ([Robin Wieruch][1])
* UI “primitives” (like `dialog.tsx`) are best kept in a dedicated UI folder, and “composites” (like `ConfirmDialog`) should be built on top of them (similar to shadcn/ui approach). ([Vercel][2])
* **i18next namespaces** are designed exactly for splitting translations into multiple files and multiple languages. ([React i18next][3])
* On Windows, Git may ignore case-only renames (filesystem is case-insensitive). We must use `git mv` and, when needed, a two-step rename. ([Git][4])

---

# Stage 0 (mandatory safety): Preparation

### 0.1 Create a branch

```bash
git checkout -b chore/structure-stage1
```

### 0.2 Clean build before changes (baseline)

```bash
npm ci
npm run build
```

(If build fails now, stop and fix baseline first.)

---

# Stage 1 (safe refactor): Unify dialogs + introduce feature hooks folders + remove “hooks depend on components” smell

## Stage 1 — Target tree (minimal change, low risk)

Keep `src/components` and `src/lib` as-is for now. Only:

* unify dialog usage
* create `hooks/` folders inside each feature and move only the “top-level” hooks there
* move `useDebouncedValue` out of `components/Search` to stop feature hooks importing from component folders

### Resulting Stage 1 tree (relevant parts)

```txt
src/
  components/
    ui/
      dialog.tsx
    ConfirmDialog.tsx
    Toaster.tsx

  features/
    LogIn/
      LogIn.tsx
      hooks/
        useLogIn.ts
    ProfileCreate/
      ProfileCreate.tsx
      hooks/
        useProfileCreate.ts
    Startup/
      Startup.tsx
      hooks/
        useStartup.ts
    Workspace/
      Workspace.tsx
      hooks/
        useWorkspace.ts
    Vault/
      Vault.tsx
      hooks/
        useVault.ts
        useBankCards.ts
        useDebouncedValue.ts
      components/
        Search/
          Search.tsx
        ...
```

---

## 1) Dialog unification: make `ConfirmDialog` use `components/ui/dialog.tsx`

### File: `src/components/ConfirmDialog.tsx`

**Replace the entire file content** with the following (same exported default, but now close-on-ESC/backdrop works through `Dialog`):

```tsx
import React from 'react';
import { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from './ui/dialog';

export type ConfirmDialogProps = {
  open: boolean;
  title: string;
  description: string;
  confirmLabel: string;
  cancelLabel: string;
  onConfirm: () => void;
  onCancel: () => void;
};

const ConfirmDialog: React.FC<ConfirmDialogProps> = ({
  open,
  title,
  description,
  confirmLabel,
  cancelLabel,
  onConfirm,
  onCancel,
}) => {
  const titleId = 'confirm-dialog-title';
  const descId = 'confirm-dialog-desc';

  return (
    <Dialog
      open={open}
      onOpenChange={(nextOpen) => {
        if (!nextOpen) onCancel();
      }}
    >
      <DialogContent aria-labelledby={titleId} aria-describedby={descId}>
        <DialogHeader>
          <DialogTitle id={titleId}>{title}</DialogTitle>
        </DialogHeader>

        <div className="dialog-body">
          <p id={descId} className="dialog-description">
            {description}
          </p>
        </div>

        <DialogFooter className="dialog-footer">
          <button type="button" className="btn btn-secondary" onClick={onCancel}>
            {cancelLabel}
          </button>
          <button type="button" className="btn btn-danger" onClick={onConfirm}>
            {confirmLabel}
          </button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
};

export default ConfirmDialog;
```

### Acceptance criteria

* Confirm dialog UI stays visually the same (same classNames).
* ESC/backdrop close triggers `onCancel` (consistent modal behavior). ([Shadcn UI][5])

---

## 2) Create hooks folders and move top-level hooks

### 2.1 Create folders

Create these directories:

* `src/features/LogIn/hooks/`
* `src/features/ProfileCreate/hooks/`
* `src/features/Startup/hooks/`
* `src/features/Workspace/hooks/`
* `src/features/Vault/hooks/`

### 2.2 Move files (use git mv)

```bash
git mv src/features/LogIn/useLogIn.ts src/features/LogIn/hooks/useLogIn.ts
git mv src/features/ProfileCreate/useProfileCreate.ts src/features/ProfileCreate/hooks/useProfileCreate.ts
git mv src/features/Startup/useStartup.ts src/features/Startup/hooks/useStartup.ts
git mv src/features/Workspace/useWorkspace.ts src/features/Workspace/hooks/useWorkspace.ts
git mv src/features/Vault/useVault.ts src/features/Vault/hooks/useVault.ts
git mv src/features/Vault/useBankCards.ts src/features/Vault/hooks/useBankCards.ts
```

### 2.3 Update imports (exact files from your archive)

#### File: `src/features/LogIn/LogIn.tsx`

**Before**

```ts
import { useLogIn } from './useLogIn';
```

**After**

```ts
import { useLogIn } from './hooks/useLogIn';
```

#### File: `src/features/ProfileCreate/ProfileCreate.tsx`

**Before**

```ts
import { useProfileCreate } from './useProfileCreate';
```

**After**

```ts
import { useProfileCreate } from './hooks/useProfileCreate';
```

#### File: `src/features/Startup/Startup.tsx`

**Before**

```ts
import { useStartup } from './useStartup';
```

**After**

```ts
import { useStartup } from './hooks/useStartup';
```

#### File: `src/features/Workspace/Workspace.tsx`

**Before**

```ts
import { useWorkspace } from './useWorkspace';
```

**After**

```ts
import { useWorkspace } from './hooks/useWorkspace';
```

#### File: `src/features/Vault/Vault.tsx`

**Before**

```ts
import { useVault } from './useVault';
import { useBankCards } from './useBankCards';
```

**After**

```ts
import { useVault } from './hooks/useVault';
import { useBankCards } from './hooks/useBankCards';
```

#### File: `src/features/Vault/components/Folders/Folders.tsx`

**Before**

```ts
import { SelectedNav } from '../../useVault';
```

**After**

```ts
import { SelectedNav } from '../../hooks/useVault';
```

#### File: `src/features/Vault/components/BankCards/BankCards.tsx`

**Before**

```ts
import { useBankCards } from '../../useBankCards';
```

**After**

```ts
import { useBankCards } from '../../hooks/useBankCards';
```

---

## 3) Move `useDebouncedValue` out of component folder (remove layering smell)

### 3.1 Move file

```bash
git mv src/features/Vault/components/Search/useDebouncedValue.ts src/features/Vault/hooks/useDebouncedValue.ts
```

### 3.2 Update imports

#### File: `src/features/Vault/hooks/useVault.ts`

**Before**

```ts
import { useDebouncedValue } from './components/Search/useDebouncedValue';
```

**After**

```ts
import { useDebouncedValue } from './useDebouncedValue';
```

#### File: `src/features/Vault/hooks/useBankCards.ts`

**Before**

```ts
import { useDebouncedValue } from './components/Search/useDebouncedValue';
```

**After**

```ts
import { useDebouncedValue } from './useDebouncedValue';
```

#### File: `src/features/Vault/components/Search/Search.tsx`

If it imports it (check):

* Update to import from `../../hooks/useDebouncedValue` (relative path from `components/Search`).

---

## 4) Stage 1 verification

```bash
npm run build
npm run dev
```

---

# Stage 2 (clean “ideal” structure): introduce `shared/` + `i18n/locales/` + clarify “what lives where”

> Start Stage 2 only after Stage 1 is green.

### Stage 2 — Target tree (new “logical” layout)

```txt
src/
  app/
    App.tsx
    main.tsx

  shared/
    ui/
      dialog.tsx
    components/
      ConfirmDialog.tsx
      Toaster.tsx
    icons/
      lucide/
        icons.ts
        index.ts
    lib/
      i18n.ts
      tauri.ts
    styles/
      base.css
      ui.css
      app.css
      screens/
      themes/

  i18n/
    locales/
      en/
        Common.json
        Tooltips.json
        Startup.json
        LogIn.json
        ProfileCreate.json
        Workspace.json
        Vault.json
        DataCards.json
        BankCards.json
        Details.json
        Folders.json
        Search.json
      ru/
        (same file set)

  features/
    ...
```

This layout makes it obvious:

* **shared/ui** = low-level primitives
* **shared/components** = reusable composites
* **features/** = product modules (Vault, Login, etc.)
* **i18n/locales** = translations by language and namespace ([React i18next][3])
