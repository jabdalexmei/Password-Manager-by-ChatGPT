
# Technical Specification: Fix Tauri v2 build failure caused by invalid `opener:*` permission

## Goal

Resolve build-time permission validation error:
`Permission opener:default not found...`

## Root Cause

A capability file includes `opener:default` (or another `opener:*` permission), but the current permission schema set does not contain any `opener:*` permissions. Tauri fails the build when an unknown permission is referenced.

## Decision

Opener plugin is NOT required for the “Eye preview” requirement (preview must be inside the app).
Therefore:

* Remove all `opener:*` permissions from capabilities.
* Remove the opener plugin initialization if it is no longer needed (recommended).
* Keep only dialog permissions needed for file pickers and save dialogs.

---

## 1) Update capability permissions (remove opener permissions)

### File(s)

All files under:
`src-tauri/capabilities/*.json`

### Change

Search for any permission entries that start with `opener:` (e.g. `opener:default`, `opener:allow-open`) and remove them.

Example:

**Before**

```json
"permissions": [
  "core:default",
  "dialog:allow-open",
  "dialog:allow-save",
  "opener:default"
]
```

**After**

```json
"permissions": [
  "core:default",
  "dialog:allow-open",
  "dialog:allow-save"
]
```

### Acceptance criteria

* `cargo build` no longer fails with “Permission opener:default not found”.

---

## 2) Remove opener plugin from Rust (if unused)

### File

`src-tauri/Cargo.toml`

### Change

If present, remove:

```toml
tauri-plugin-opener = "..."
```

### File

`src-tauri/src/main.rs`

### Change

If present, remove:

```rust
.plugin(tauri_plugin_opener::init())
```

### Acceptance criteria

* Rust build does not require opener crates.
* No references to `tauri_plugin_opener` remain in code.

---

## 3) Replace any remaining “Open attachment” behavior with in-app preview (no opener)

If any frontend code still calls a command like `open_attachment`, it must be replaced by:

* `get_attachment_preview` (returns base64 in-memory payload) for the Eye button
* `save_attachment_to_path` for the Download button

(No external open.)

---

## End-to-end Acceptance criteria

* `npm run tauri dev` proceeds past the build script stage (no permission validation error).



Если ты всё же хочешь opener **только для будущего** (например отдельная кнопка “Open externally”), тогда надо будет правильно подключить permission pack для opener plugin под твою версию. Но сейчас это прямо противоречит твоему требованию “не терять шифрование”, поэтому я бы не тратил на это ни секунды.
