

## TS (English): Fix crash when opening Bank Card details (Hook order mismatch)

### Title

Fix BankCardDetails crash (“Rendered more hooks than during the previous render”) when selecting a Bank Card

### Severity

HIGH (UI becomes blank / only background remains)

### Reproduction

1. Run the app.
2. Open **Bank cards** section.
3. Create a bank card.
4. Click/select the created bank card to open details.
5. UI disappears, only background remains (React render crash).

### Root cause

`BankCardDetails` calls `useMemo` **after** an early return (`if (!card) return ...`).
When `card` changes from `null` → `BankCardItem`, the number of hooks changes between renders, violating React Rules of Hooks and crashing the render tree. ([legacy.reactjs.org][1])

### Files to change

`src/features/Vault/components/BankCards/BankCardDetails.tsx`

### Required changes

#### 1) Remove conditional hook usage by eliminating `useMemo` for tags text

**Current code (problematic):**

* `useMemo` is declared **after**:

```tsx
if (!card) {
  return ( ... );
}
...
const tagsText = useMemo(() => card.tags?.join(', ') ?? '', [card.tags]);
```

**Change to:**

* Remove `useMemo` import.
* Replace the `tagsText` computation with a plain expression (no hook), so hook count is identical regardless of `card` state.

**Implementation details:**

1. Update imports:

```diff
- import React, { useMemo, useState } from 'react';
+ import React, { useState } from 'react';
```

2. Replace tags text calculation:

```diff
- const tagsText = useMemo(() => card.tags?.join(', ') ?? '', [card.tags]);
+ const tagsText = card.tags?.join(', ') ?? '';
```

3. Keep the rest of the component unchanged.

### Acceptance criteria

1. Selecting a bank card **never** crashes the UI; details panel renders reliably.
2. No “Rendered more hooks than during the previous render” / “change in the order of Hooks” errors in console.
3. Tags display correctly in details (comma-separated).
4. Behavior with `card = null` still shows the “select prompt” empty state.

### Manual test plan

1. Start the app, open Bank cards.
2. With no selection: verify empty prompt renders.
3. Create a new bank card.
4. Click it immediately: details must render, UI must not disappear.
5. Rapidly switch selection between cards and empty state: no crashes.

