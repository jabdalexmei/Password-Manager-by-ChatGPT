## TS (EN): Remove “Retention days” from Backups settings (UI + backend)

### Goal

Completely remove the “Retention days” feature for backups:

* Remove the input from Settings UI.
* Remove the `backup_retention_days` field from frontend and Rust types.
* Remove retention-based pruning (`apply_retention`) from backup creation flows.
* Remove the unused i18n string key.

### Non-goals

* Do **not** change `backup_max_copies` behavior (it will still delete oldest managed backups when the limit is exceeded).

---

## 1) Frontend: remove UI field + state + validations

### File: `src/features/Vault/components/modals/SettingsModal.tsx`

#### Patch

```diff
diff --git a/src/features/Vault/components/modals/SettingsModal.tsx b/src/features/Vault/components/modals/SettingsModal.tsx
index 0000000..0000000 100644
--- a/src/features/Vault/components/modals/SettingsModal.tsx
+++ b/src/features/Vault/components/modals/SettingsModal.tsx
@@ -1,7 +1,7 @@
 import React, { useEffect, useMemo, useState } from 'react';
 import { BackendUserSettings } from '../../types/backend';
 import { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from '../../../../shared/ui/dialog';
@@
 export function SettingsModal({ open, settings, isSaving, onCancel, onSave }: SettingsModalProps) {
@@
   const [autoBackupEnabled, setAutoBackupEnabled] = useState(false);
   const [intervalMinutes, setIntervalMinutes] = useState('60');
   const [maxCopies, setMaxCopies] = useState('10');
-  const [retentionDays, setRetentionDays] = useState('30');
@@
   useEffect(() => {
     if (!open || !settings) return;
@@
     setAutoBackupEnabled(settings.backups_enabled);
     setIntervalMinutes(String(settings.auto_backup_interval_minutes));
     setMaxCopies(String(settings.backup_max_copies));
-    setRetentionDays(String(settings.backup_retention_days));
   }, [open, settings]);
@@
   const canSave = useMemo(() => {
@@
     const interval = Number(intervalMinutes);
     const max = Number(maxCopies);
-    const retention = Number(retentionDays);
     if (
       !Number.isFinite(lockTimeout) ||
       !Number.isFinite(clipTimeout) ||
       !Number.isFinite(interval) ||
-      !Number.isFinite(max) ||
-      !Number.isFinite(retention)
+      !Number.isFinite(max)
     ) {
       return false;
     }
@@
     if (autoBackupEnabled && (interval < 5 || interval > 1440)) return false;
     if (max < 1 || max > 500) return false;
-    if (retention < 1 || retention > 3650) return false;
     return true;
   }, [
     autoBackupEnabled,
     autoLockEnabled,
     autoLockTimeoutSeconds,
     clipboardClearTimeoutSeconds,
     intervalMinutes,
     maxCopies,
-    retentionDays,
   ]);
@@
   const handleSave = () => {
     if (!settings) return;
@@
     const interval = Number(intervalMinutes);
     const max = Number(maxCopies);
-    const retention = Number(retentionDays);
@@
     if (!Number.isFinite(interval) || !Number.isFinite(max)) return;
     if (autoBackupEnabled && (interval < 5 || interval > 1440)) return;
     if (max < 1 || max > 500) return;
-    if (!Number.isFinite(retention) || retention < 1 || retention > 3650) return;
@@
     const nextSettings: BackendUserSettings = {
       ...settings,
@@
       backups_enabled: autoBackupEnabled,
       auto_backup_interval_minutes: interval,
       backup_max_copies: max,
-      backup_retention_days: retention,
     };
@@
           <div role="group" aria-labelledby="backups-title" style={{ display: 'flex', flexDirection: 'column', gap: 14 }}>
@@
             <div className="form-field">
               <label className="form-label" htmlFor="backup-max-copies">
                 Max copies
               </label>
               <input
                 id="backup-max-copies"
                 type="number"
                 min={1}
                 max={500}
                 value={maxCopies}
                 disabled={busy}
                 inputMode="numeric"
                 onChange={(event) => setMaxCopies(event.target.value)}
                 style={fullWidthInputStyle}
               />
             </div>
-
-            <div className="form-field">
-              <label className="form-label" htmlFor="backup-retention-days">
-                Retention days
-              </label>
-              <input
-                id="backup-retention-days"
-                type="number"
-                min={1}
-                max={3650}
-                value={retentionDays}
-                disabled={busy}
-                inputMode="numeric"
-                onChange={(event) => setRetentionDays(event.target.value)}
-                style={fullWidthInputStyle}
-              />
-            </div>
           </div>
```

---

## 2) Frontend types: remove `backup_retention_days`

### File: `src/features/Vault/types/backend.ts`

```diff
diff --git a/src/features/Vault/types/backend.ts b/src/features/Vault/types/backend.ts
index 0000000..0000000 100644
--- a/src/features/Vault/types/backend.ts
+++ b/src/features/Vault/types/backend.ts
@@
 export type BackendUserSettings = {
@@
   backup_max_copies: number;
   backup_frequency: "daily" | "weekly" | "monthly";
-  backup_retention_days: number;
   default_sort_field: "created_at" | "updated_at" | "title";
   default_sort_direction: "ASC" | "DESC";
   mask_password_by_default: boolean;
 };
```

---

## 3) i18n: remove unused translation key (optional but clean)

### File: `src/i18n/locales/en/Vault.json`

This key is no longer used after removing the UI field:

```diff
diff --git a/src/i18n/locales/en/Vault.json b/src/i18n/locales/en/Vault.json
index 0000000..0000000 100644
--- a/src/i18n/locales/en/Vault.json
+++ b/src/i18n/locales/en/Vault.json
@@
   "backup.settings.autoEnabled": "Auto backup enabled",
   "backup.settings.intervalMinutes": "Interval (minutes)",
-  "backup.settings.retentionDays": "Retention days",
   "backup.settings.save": "Save",
   "backup.auto.success": "Auto-backup created"
 }
```

---

## 4) Backend: remove setting field from Rust struct + defaults

### File: `src-tauri/src/types.rs`

```diff
diff --git a/src-tauri/src/types.rs b/src-tauri/src/types.rs
index 0000000..0000000 100644
--- a/src-tauri/src/types.rs
+++ b/src-tauri/src/types.rs
@@
 pub struct UserSettings {
@@
     pub backups_enabled: bool,
     #[serde(default = "default_auto_backup_interval_minutes")]
     pub auto_backup_interval_minutes: i64,
     #[serde(default = "default_backup_max_copies")]
     pub backup_max_copies: i64,
     pub backup_frequency: String,
-    pub backup_retention_days: i64,
@@
 impl Default for UserSettings {
     fn default() -> Self {
         Self {
@@
             backups_enabled: false,
             auto_backup_interval_minutes: default_auto_backup_interval_minutes(),
             backup_max_copies: default_backup_max_copies(),
             backup_frequency: "weekly".to_string(),
-            backup_retention_days: 30,
             default_sort_field: "updated_at".to_string(),
             default_sort_direction: "DESC".to_string(),
             mask_password_by_default: true,
         }
     }
 }
```

---

## 5) Backend: remove validation for removed field

### File: `src-tauri/src/services/settings_service.rs`

```diff
diff --git a/src-tauri/src/services/settings_service.rs b/src-tauri/src/services/settings_service.rs
index 0000000..0000000 100644
--- a/src-tauri/src/services/settings_service.rs
+++ b/src-tauri/src/services/settings_service.rs
@@
 fn validate_settings(settings: &UserSettings) -> Result<()> {
@@
     let valid_values = [
         in_range(settings.auto_hide_secret_timeout_seconds, 1, 600),
         in_range(settings.clipboard_clear_timeout_seconds, 1, 600),
         in_range(settings.auto_lock_timeout, 30, 86_400),
         in_range(settings.trash_retention_days, 1, 3_650),
-        in_range(settings.backup_retention_days, 1, 3_650),
     ]
     .into_iter()
     .all(|v| v);
```

---

## 6) Backend: remove retention pruning logic for backups

### File: `src-tauri/src/services/backup_service.rs`

#### A) Delete `apply_retention(...)` function

```diff
diff --git a/src-tauri/src/services/backup_service.rs b/src-tauri/src/services/backup_service.rs
index 0000000..0000000 100644
--- a/src-tauri/src/services/backup_service.rs
+++ b/src-tauri/src/services/backup_service.rs
@@
 fn prune_registry(registry: &mut BackupRegistry) {
     registry.backups.retain(|item| PathBuf::from(&item.path).exists());
 }
-
-fn apply_retention(settings: &UserSettings, managed_root: &Path, registry: &mut BackupRegistry) {
-    let retention_days = settings.backup_retention_days;
-    let cutoff = Utc::now() - chrono::Duration::days(retention_days);
-    registry.backups.retain(|entry| {
-        let path = PathBuf::from(&entry.path);
-        if !path.starts_with(managed_root) {
-            return true;
-        }
-        let keep = chrono::DateTime::parse_from_rfc3339(&entry.created_at_utc)
-            .map(|dt| dt.with_timezone(&Utc) >= cutoff)
-            .unwrap_or(true);
-        if !keep {
-            let _ = fs::remove_file(&entry.path);
-        }
-        keep
-    });
-}
```

#### B) Remove calls to `apply_retention(...)` in both backup creation flows

1. In `backup_create(...)`:

```diff
@@
     update_registry(&sp, &profile_id, |registry| {
         registry.backups.push(BackupListItem {
@@
         });
         prune_registry(registry);
-        apply_retention(&settings, &managed_root, registry);
         apply_max_copies(&settings, &managed_root, registry);
     })?;
```

2. In `backup_create_if_due_auto(...)`:

```diff
@@
     prune_registry(&mut registry);
-    apply_retention(&settings, &managed_root, &mut registry);
     apply_max_copies(&settings, &managed_root, &mut registry);
     save_registry(&sp, &profile_id, &registry)?;
```

---

## Acceptance Criteria (must pass)

1. **UI**: “Retention days” is not shown in Settings → Backups.
2. **Build**: `npm run dev` / `vite` compiles without missing fields errors.
3. **Rust build**: `cargo build` in `src-tauri` compiles without references to `backup_retention_days` or `apply_retention`.
4. **Behavior**:

   * Creating backups does **not** delete any backup due to age.
   * Max copies behavior remains unchanged: when a new managed backup exceeds the limit, the oldest managed backup is deleted.

---

## Notes (why old settings files won’t break)

If an existing `user_settings.json` still contains `"backup_retention_days": ...`, it will be ignored during deserialization by default for JSON unless you explicitly enabled `#[serde(deny_unknown_fields)]`. ([serde.rs][1])

