TS (EN) — Split into Parts (Incremental Delivery)
Общие правила поставки (для исполнителя)

Each part must be delivered as a PR/branch with commits.

Do not add placeholders/stubs. If a part includes UI, the backend must work for that part.

Provide evidence: screenshots + short console logs for the acceptance checks of that part.

## Общие правила поставки (для исполнителя)

* Each part must be delivered as a PR/branch with commits.
* Do not add placeholders/stubs. If a part includes UI, the backend must work for that part.
* Provide evidence: screenshots + short console logs for the acceptance checks of that part.



## Part 4 — Attachments: add + list + delete (no preview/download yet)

### Goal

Make attachments CRUD stable first.

### Changes

#### 4.1 Fix dialog imports (Tauri v2)

Use:

* `@tauri-apps/plugin-dialog`

**File**

* `src/features/Vault/components/Details/useDetails.tsx` (and any dialog usage)

#### 4.2 Fix invoke arg keys for attachment commands

Use snake_case in all attachment invocations.

#### 4.3 Implement delete confirmation (UI)

Use existing confirm modal patterns.

### Acceptance checks

* Add attachment to a card (select file) → appears in Information list.
* Delete attachment → confirm → disappears.
* No “Operation failed”.

---

## Part 5 — Attachments: download (export icon) + internal preview (eye icon)

### Goal

Implement the new toolbar behavior (eye=preview inside app, export=save to disk).

### Changes

#### 5.1 Backend: add preview command returning bytes

**Command**

* `get_attachment_preview(attachment_id) -> { file_name, mime, bytes_b64 }`

#### 5.2 Frontend: AttachmentPreviewDialog

New file:

* `src/features/Vault/components/modals/AttachmentPreviewDialog.tsx`

Render rules:

* image: `<img src="data:mime;base64,...">`
* pdf: `<iframe ...>`
* unknown: show “Preview not supported; use Download”

#### 5.3 Download to disk

Frontend uses `save()` dialog to get path, then calls backend command:

* `save_attachment_to_path(attachment_id, target_path)`

### Acceptance checks

* Eye opens preview inside app for png/jpg/pdf.
* Export saves file to chosen location.
* No external opener used.

---

## Part 6 — Backup: implement real backend (remove stubs) + UI flow

### Goal

Export/import encrypted zip backups fully working.

### Changes

#### 6.1 Implement `backup_service.rs` (remove BACKUP_UNSUPPORTED_VERSION stubs)

**Files**

* `src-tauri/src/services/backup_service.rs`
* `src-tauri/src/commands/backup.rs` (create)
* settings persistence for last/default export dir

#### 6.2 UI modals

* Export modal: profile password vs custom password; remember folder
* Import modal: password + two buttons:

  * Restore (enabled only when profile unlocked)
  * Import as new profile (ask for profile name; password=backup password)

### Acceptance checks

* Export creates `.zip` encrypted backup.
* Import with wrong password fails cleanly.
* Import as new profile creates a new profile and opens with backup password.
* Restore overwrites current profile (only when unlocked).

