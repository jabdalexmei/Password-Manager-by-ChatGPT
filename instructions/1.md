

## Technical Specification (EN): Inline TOTP rendering in Details.tsx (remove TotpField.tsx)

### Scope

* Remove component file `TotpField.tsx`.
* Inline TOTP (2FA) rendering into `Details.tsx` using the same UI structure as other fields.
* Use existing `detailActions.copyToClipboard(...)` for copying the TOTP code (no `lib/clipboard`).

---

### 1) Delete the redundant file

**Action:** delete file

**Path:**
`src/features/Vault/components/Details/TotpField.tsx`

---

### 2) Update `Details.tsx` imports

**File:**
`src/features/Vault/components/Details/Details.tsx`

#### 2.1 Remove this import

**Remove line:**

```ts
import { TotpField } from './TotpField';
```

#### 2.2 Add import for generator util

**Add import:**

```ts
import { generateTotpCode } from '../../utils/totp';
```

(Keep `IconCopy` import as-is â€” it is already used by other fields.)

---

### 3) Add TOTP timer state into `Details.tsx`

**File:**
`src/features/Vault/components/Details/Details.tsx`

Inside `export function Details(...) { ... }`, after existing `useState(...)` declarations (near other local state), add:

```ts
const [totpNow, setTotpNow] = useState(() => Date.now());

useEffect(() => {
  if (!card?.totpUri) return;

  const id = window.setInterval(() => setTotpNow(Date.now()), 1000);
  return () => window.clearInterval(id);
}, [card?.totpUri]);
```

---

### 4) Compute TOTP token + countdown in `Details.tsx`

**File:**
`src/features/Vault/components/Details/Details.tsx`

After the existing computed values (near `passwordDisplay`, `hasPassword`, etc.), add:

```ts
const totpData = useMemo(() => {
  if (!card.totpUri) return null;

  try {
    return generateTotpCode(card.totpUri, totpNow);
  } catch {
    return null;
  }
}, [card.totpUri, totpNow]);
```

Note: `card` is guaranteed non-null after the existing `if (!card) return ...;`.

---

### 5) Replace `<TotpField />` render with inline field block

**File:**
`src/features/Vault/components/Details/Details.tsx`

Find this line:

```tsx
{card.totpUri && <TotpField uri={card.totpUri} />}
```

Replace it with:

```tsx
{card.totpUri && (
  <div className="detail-field">
    <div className="detail-label">{t('label.totp')}</div>

    <div className="detail-value-box">
      <div className="detail-value-text" style={{ display: 'flex', alignItems: 'baseline', gap: 12 }}>
        <span style={{ fontSize: 20, fontWeight: 700, letterSpacing: 2 }}>
          {totpData ? totpData.token : t('totp.invalid')}
        </span>

        {totpData && (
          <span className="muted" style={{ fontSize: 12 }}>
            {t('totp.expiresIn', { seconds: totpData.remaining })}
          </span>
        )}
      </div>

      {totpData && (
        <div className="detail-value-actions">
          <button
            className="icon-button"
            type="button"
            aria-label={t('action.copy')}
            onClick={() => detailActions.copyToClipboard(totpData.token, { isSecret: true })}
          >
            <IconCopy />
          </button>
        </div>
      )}
    </div>
  </div>
)}
```

This ensures:

* same layout as other fields (`detail-field` etc.)
* copy uses the existing centralized copy behavior (including secret handling), via `detailActions.copyToClipboard(...)`

---

### 6) Verify translations (no changes required)

Your project already contains these keys:

* `label.totp`
* `totp.invalid`
* `totp.expiresIn`

**File:**
`src/i18n/English/Details.json`

No update required unless you changed key names.

---

### 7) Acceptance Criteria

1. App builds without the Vite import-resolution error referencing `lib/clipboard`.
2. TOTP is rendered in `Details.tsx` using the same styling/layout blocks as other fields.
3. TOTP code updates every second (countdown changes), token changes on period boundary.
4. Copy button copies only the current token using `detailActions.copyToClipboard(..., { isSecret: true })`.
5. `TotpField.tsx` is fully removed and no longer referenced anywhere.


