diff --git a/src-tauri/src/services/security_service.rs b/src-tauri/src/services/security_service.rs
index 9d8b7b1..c4a8a2d 100644
--- a/src-tauri/src/services/security_service.rs
+++ b/src-tauri/src/services/security_service.rs
@@ -286,6 +286,7 @@ pub fn set_profile_password(id: &str, password: &str, state: &Arc<AppState>) -> Result<ProfileMeta> {
     let profile = registry::get_profile(&storage_paths, id)?
         .ok_or_else(|| ErrorCodeString::new("PROFILE_NOT_FOUND"))?;
 
+    // registry::get_profile now self-heals has_password based on disk state.
     if profile.has_password {
         return Err(ErrorCodeString::new("PROFILE_ALREADY_PROTECTED"));
     }
@@ -315,18 +316,18 @@ pub fn set_profile_password(id: &str, password: &str, state: &Arc<AppState>) -> Result<ProfileMeta> {
         return Err(ErrorCodeString::new("VAULT_CORRUPTED"));
     }
 
-    // Serialize passwordless sqlite file to bytes.
-    let conn = rusqlite::Connection::open(&vault_path)
-        .map_err(|_| ErrorCodeString::new("DB_OPEN_FAILED"))?;
-    migrations::migrate_to_latest(&conn)?;
-    let serialized = conn
-        .serialize(DatabaseName::Main)
-        .map_err(|_| ErrorCodeString::new("DB_QUERY_FAILED"))?;
-    drop(conn);
-
-    let bytes = serialized.to_vec();
+    // Serialize passwordless sqlite file to bytes.
+    // NOTE: serialize() may borrow the connection, so materialize bytes while conn is alive.
+    let bytes: Vec<u8> = {
+        let conn = rusqlite::Connection::open(&vault_path)
+            .map_err(|_| ErrorCodeString::new("DB_OPEN_FAILED"))?;
+        migrations::migrate_to_latest(&conn)?;
+        let serialized = conn
+            .serialize(DatabaseName::Main)
+            .map_err(|_| ErrorCodeString::new("DB_QUERY_FAILED"))?;
+        serialized.to_vec()
+    };
@@ -375,9 +376,18 @@ pub fn set_profile_password(id: &str, password: &str, state: &Arc<AppState>) -> Result<ProfileMeta> {
         });
     }
 
-    // Update registry flag.
-    let updated = registry::upsert_profile_with_id(&storage_paths, id, &profile.name, true)?;
-    Ok(updated.into())
+    // Update registry flag.
+    // IMPORTANT: If the vault has already been encrypted, do not return an error just because
+    // registry/config write failed â€” otherwise UI shows "Failed..." but the profile is actually protected.
+    match registry::upsert_profile_with_id(&storage_paths, id, &profile.name, true) {
+        Ok(updated) => Ok(updated.into()),
+        Err(_) => Ok(ProfileMeta {
+            id: profile.id,
+            name: profile.name,
+            has_password: true,
+        }),
+    }
 }
